<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 4: Datapath Implementation - Report</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: white;
            color: #333;
        }
        .container {
            max-width: 8.5in;
            margin: 0 auto;
            padding: 1in;
            background: white;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .course-info {
            font-size: 14px;
            color: #95a5a6;
        }
        
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        
        .subsection-title {
            font-size: 16px;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 10px;
            margin-top: 20px;
        }
        
        .screenshot-container {
            text-align: center;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        .screenshot {
            max-width: 100%;
            height: auto;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-height: 400px;
            width: auto;
        }
        
        .screenshot-caption {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 8px;
            font-style: italic;
        }
        
        .question {
            background-color: #ecf0f1;
            padding: 15px;
            border-left: 4px solid #e74c3c;
            margin: 15px 0;
        }
        
        .question-text {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .answer {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #27ae60;
            margin: 10px 0;
        }
        
        .circuit-description {
            background-color: #fff3cd;
            padding: 15px;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .instruction-analysis {
            background-color: #e8f4fd;
            padding: 15px;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .hex-instruction {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .register-table {
            margin: 20px 0;
            border-collapse: collapse;
            width: 100%;
        }
        
        .register-table th,
        .register-table td {
            border: 1px solid #bdc3c7;
            padding: 8px;
            text-align: center;
        }
        
        .register-table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }
        
        .register-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .conclusion {
            background-color: #e8f5e8;
            padding: 20px;
            border: 1px solid #27ae60;
            border-radius: 5px;
            margin-top: 30px;
        }
        
        .team-info {
            background-color: #f0f8ff;
            padding: 15px;
            border: 1px solid #3498db;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        
        .placeholder {
            background-color: #f8f9fa;
            border: 2px dashed #6c757d;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .placeholder-text {
            color: #6c757d;
            font-style: italic;
            font-size: 14px;
        }
        
        .datapath-component {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .component-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        @media print {
            body { margin: 20px; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
        <div class="title">CENG 351: Computer Architecture I</div>
        <div class="subtitle">Lab 4: Datapath Implementation</div>
        <div class="course-info">MIPS Datapath Design and Instruction Execution Analysis</div>
    </div>

    <div class="team-info">
        <div class="subsection-title">Team Information</div>
        <p><strong>Lab Partners:</strong> Gabriel Giancarlo, Jun Yi</p>
        <p><strong>Contributions:</strong></p>
        <ul>
            <li><strong>Gabriel Giancarlo:</strong> Report writing, instruction analysis, datapath explanation, and comprehensive documentation</li>
            <li><strong>Jun Yi:</strong> Circuit implementation, screenshot capture, simulation execution, and verification</li>
        </ul>
    </div>

    <div class="section">
        <div class="section-title">1. Introduction</div>
        <p>In this lab, we built and tested a MIPS datapath to see how a processor actually runs instructions. We put together all the main parts of a CPU datapath like instruction memory, register file, ALU, data memory, and control logic.</p>
        
        <div class="circuit-description">
            <div class="subsection-title">Datapath Overview</div>
            <p>Our MIPS datapath has these main parts:</p>
            <ul>
                <li><strong>Instruction Memory:</strong> Holds all the program instructions in hex format</li>
                <li><strong>Program Counter (PC):</strong> Keeps track of which instruction we're running</li>
                <li><strong>Register File:</strong> Has 32 registers that can each hold 32 bits</li>
                <li><strong>Arithmetic Logic Unit (ALU):</strong> Does all the math and logic operations</li>
                <li><strong>Data Memory:</strong> Stores data that the program needs to load and save</li>
                <li><strong>Control Logic:</strong> Figures out what each instruction does and tells other parts what to do</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <div class="section-title">2. Instruction Analysis</div>
        
        <div class="subsection-title">2.1 Hex Program Analysis</div>
        <p>We got a hex program that has these MIPS instructions:</p>
        
        <div class="instruction-analysis">
            <div class="subsection-title">Instruction Breakdown</div>
            <p><strong>Address 0x0000:</strong> <span class="hex-instruction">20100024</span> - addi $16, $0, 36 (Load immediate value 36 into register $16)</p>
            <p><strong>Address 0x0004:</strong> <span class="hex-instruction">ac100004</span> - sw $16, 4($0) (Store word from $16 to memory address 4)</p>
            <p><strong>Address 0x0008:</strong> <span class="hex-instruction">8c110004</span> - lw $17, 4($0) (Load word from memory address 4 into $17)</p>
            <p><strong>Address 0x000C:</strong> <span class="hex-instruction">2231ffff</span> - addi $17, $17, -1 (Decrement $17 by 1)</p>
            <p><strong>Address 0x0010:</strong> <span class="hex-instruction">02114022</span> - sub $8, $16, $17 (Subtract $17 from $16, store in $8)</p>
            <p><strong>Address 0x0014:</strong> <span class="hex-instruction">01114824</span> - and $9, $8, $17 (Bitwise AND of $8 and $17, store in $9)</p>
            <p><strong>Address 0x0018:</strong> <span class="hex-instruction">1109fff9</span> - beq $8, $9, -7 (Branch if $8 equals $9, jump back 7 instructions)</p>
            <p><strong>Address 0x001C:</strong> <span class="hex-instruction">00000000</span> - nop (No operation)</p>
        </div>

        <div class="subsection-title">2.2 Program Flow Analysis</div>
        <p>This program basically makes a simple loop that:</p>
        <ol>
            <li>Puts the number 36 into register $16</li>
            <li>Saves that number in memory location 4</li>
            <li>Loads the number back into register $17</li>
            <li>Takes 1 away from $17</li>
            <li>Finds the difference between $16 and $17</li>
            <li>Does a bitwise AND operation</li>
            <li>Jumps back if the values are the same, making it loop</li>
        </ol>
    </div>

    <div class="section">
        <div class="section-title">3. Datapath Implementation</div>
        
        <div class="subsection-title">3.1 Circuit Components</div>
        
        <div class="datapath-component">
            <div class="component-name">Program Counter (PC)</div>
            <p>This is a 32-bit register that remembers which instruction we're working on. It goes up by 4 for each instruction (unless we're jumping or branching).</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Instruction Memory</div>
            <p>This is where all the program instructions are stored. The PC tells it which instruction we want, and it gives us back the 32-bit instruction.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Register File</div>
            <p>This has 32 registers that can each hold 32 bits. We can read from two registers at once and write to one. Register $0 is always zero.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Arithmetic Logic Unit (ALU)</div>
            <p>This does all the math and logic stuff. It takes two 32-bit numbers and can add, subtract, do AND/OR operations, and compare them.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Data Memory</div>
            <p>This is where we store data that the program needs. We can read from it and write to it using load and store instructions.</p>
        </div>

        <div class="subsection-title">3.2 Control Signals</div>
        <p>The datapath uses different control signals to make sure everything works together:</p>
        <ul>
            <li><strong>RegWrite:</strong> Lets us write to the register file</li>
            <li><strong>MemRead/MemWrite:</strong> Controls when we can read or write to data memory</li>
            <li><strong>ALUOp:</strong> Tells the ALU what operation to do</li>
            <li><strong>RegDst:</strong> Picks which register to write to</li>
            <li><strong>ALUSrc:</strong> Chooses between register values and immediate values</li>
            <li><strong>Branch:</strong> Lets branch instructions work</li>
        </ul>
    </div>

    <div class="section">
        <div class="section-title">4. Screenshots and Simulation Results</div>
        
        <div class="subsection-title">4.1 Initial Circuit State</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/startState.png" alt="Initial datapath circuit state" class="screenshot">
            <div class="screenshot-caption">Figure 1: Initial datapath circuit state</div>
        </div>

        <div class="subsection-title">4.2 Register File State</div>
        <div class="screenshot-container">
            <div class="placeholder">
                <div class="placeholder-text">
                    [SCREENSHOT PLACEHOLDER]<br>
                    Register file showing initial values and changes during execution<br>
                    <strong>To be added by partner:</strong> Screenshot of register file with values
                </div>
            </div>
            <div class="screenshot-caption">Figure 2: Register file state during execution</div>
        </div>

        <div class="subsection-title">4.3 Memory State</div>
        <div class="screenshot-container">
            <div class="placeholder">
                <div class="placeholder-text">
                    [SCREENSHOT PLACEHOLDER]<br>
                    Data memory showing stored values at various addresses<br>
                    <strong>To be added by partner:</strong> Screenshot of data memory contents
                </div>
            </div>
            <div class="screenshot-caption">Figure 3: Data memory state</div>
        </div>

        <div class="subsection-title">4.4 ALU Operations</div>
        <div class="screenshot-container">
            <div class="placeholder">
                <div class="placeholder-text">
                    [SCREENSHOT PLACEHOLDER]<br>
                    ALU showing input values, operation, and output result<br>
                    <strong>To be added by partner:</strong> Screenshot of ALU during operation
                </div>
            </div>
            <div class="screenshot-caption">Figure 4: ALU operation execution</div>
        </div>

        <div class="subsection-title">4.5 Control Signals</div>
        <div class="screenshot-container">
            <div class="placeholder">
                <div class="placeholder-text">
                    [SCREENSHOT PLACEHOLDER]<br>
                    Control unit showing active control signals for current instruction<br>
                    <strong>To be added by partner:</strong> Screenshot of control signals
                </div>
            </div>
            <div class="screenshot-caption">Figure 5: Control signals during instruction execution</div>
        </div>

        <div class="subsection-title">4.6 Wire States and Data Flow</div>
        <div class="screenshot-container">
            <div class="placeholder">
                <div class="placeholder-text">
                    [SCREENSHOT PLACEHOLDER]<br>
                    Datapath showing data flow through wires and connections<br>
                    <strong>To be added by partner:</strong> Screenshot showing wire states and data flow
                </div>
            </div>
            <div class="screenshot-caption">Figure 6: Wire states and data flow visualization</div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">5. Lab Questions and Analysis</div>

        <div class="question">
            <div class="question-text">Question 1: Explain the purpose of each component in the MIPS datapath and how they work together to execute instructions.</div>
        </div>
        <div class="answer">
            <p>All the MIPS datapath parts work together to run instructions:</p>
            <ul>
                <li><strong>Program Counter (PC):</strong> Keeps track of which instruction we're on. It goes up by 4 for each instruction or jumps to a new address for branches and jumps.</li>
                <li><strong>Instruction Memory:</strong> Holds all the program instructions. The PC tells it which instruction we want, and it gives us back the 32-bit instruction.</li>
                <li><strong>Register File:</strong> Gives us quick access to 32 registers. We can read from two registers and write to one at the same time.</li>
                <li><strong>ALU:</strong> Does the actual math and logic that the instruction needs. It takes two 32-bit numbers and gives us a result plus some status flags.</li>
                <li><strong>Data Memory:</strong> Stores data that we can load into registers or save from registers. It's separate from instruction memory so we can access both at the same time.</li>
                <li><strong>Control Unit:</strong> Figures out what the instruction does and tells all the other parts what to do.</li>
            </ul>
            <p>Everything works like a pipeline: the PC gets the instruction address, instruction memory gives us the instruction, the control unit figures out what to do, the register file gives us the numbers we need, the ALU does the work, and data memory handles loading and storing.</p>
        </div>

        <div class="question">
            <div class="question-text">Question 2: Analyze the provided hex program and explain what it does step by step.</div>
        </div>
        <div class="answer">
            <p>The hex program makes a simple loop that shows different types of MIPS instructions:</p>
            <ol>
                <li><strong>addi $16, $0, 36:</strong> Puts the number 36 into register $16</li>
                <li><strong>sw $16, 4($0):</strong> Saves the value in register $16 (36) to memory address 4</li>
                <li><strong>lw $17, 4($0):</strong> Loads the value from memory address 4 (36) into register $17</li>
                <li><strong>addi $17, $17, -1:</strong> Takes 1 away from register $17 (now it has 35)</li>
                <li><strong>sub $8, $16, $17:</strong> Finds the difference between $16 (36) and $17 (35), puts the result (1) in $8</li>
                <li><strong>and $9, $8, $17:</strong> Does a bitwise AND between $8 (1) and $17 (35), puts the result in $9</li>
                <li><strong>beq $8, $9, -7:</strong> Jumps back 7 instructions if $8 equals $9, making it loop</li>
            </ol>
            <p>Basically, this program makes a loop that counts down and does some math, showing how a processor does its basic operations.</p>
        </div>

        <div class="question">
            <div class="question-text">Question 3: What are the key differences between instruction memory and data memory in the MIPS architecture?</div>
        </div>
        <div class="answer">
            <p>Instruction memory and data memory do different things in MIPS:</p>
            <ul>
                <li><strong>Purpose:</strong> Instruction memory holds the program code, while data memory holds the data that the program works with.</li>
                <li><strong>Access Pattern:</strong> Instruction memory is usually read-only when the program runs, while data memory lets us both read and write.</li>
                <li><strong>Addressing:</strong> Instruction memory is accessed in order using the Program Counter, while data memory is accessed using addresses from load/store instructions.</li>
                <li><strong>Width:</strong> Both are 32-bit, but instruction memory gives us complete instruction words, while data memory can be accessed in different sizes.</li>
                <li><strong>Timing:</strong> Instruction memory access happens during the fetch stage, while data memory access happens during the memory stage.</li>
                <li><strong>Control:</strong> Instruction memory access is automatic (the PC does it), while data memory access is controlled by load/store instructions.</li>
            </ul>
            <p>Having them separate lets us access instructions and data at the same time, which makes the processor faster and more efficient.</p>
        </div>

        <div class="question">
            <div class="question-text">Question 4: How does the ALU determine which operation to perform, and what are the different types of operations it can execute?</div>
        </div>
        <div class="answer">
            <p>The ALU figures out what to do based on the ALUOp control signal that the control unit makes:</p>
            <ul>
                <li><strong>ALUOp Encoding:</strong> The control unit looks at the instruction opcode and function field to figure out what ALU operation to do.</li>
                <li><strong>Operation Types:</strong>
                    <ul>
                        <li><strong>Arithmetic:</strong> Addition (add, addi), subtraction (sub), multiplication (mult)</li>
                        <li><strong>Logical:</strong> AND (and, andi), OR (or, ori), XOR (xor, xori), NOR (nor)</li>
                        <li><strong>Comparison:</strong> Set Less Than (slt, slti), checking if things are equal for branches</li>
                        <li><strong>Shift Operations:</strong> Left shift (sll), right shift (srl, sra)</li>
                    </ul>
                </li>
                <li><strong>Control Logic:</strong> The ALU control unit uses the ALUOp signal and the function field of R-type instructions to make the specific ALU control signals.</li>
                <li><strong>Output Flags:</strong> The ALU gives us a result and status flags (zero, overflow, carry) that are used for branches and error handling.</li>
            </ul>
            <p>The ALU is basically the brain of the processor that does all the math and logic stuff.</p>
        </div>
    </div>

    <div class="section">
        <div class="section-title">6. Troubleshooting and Challenges</div>
        
        <div class="subsection-title">6.1 Collaboration and Merge Conflicts</div>
        <p>One of the biggest challenges we faced during this lab was working together on the same circuit file. Since we were both working on different parts of the skeleton, whenever one of us moved components around or changed something, we'd get merge conflicts when trying to combine our work.</p>
        
        <p>This was really frustrating because we had to put in extra effort to figure out how to merge our changes without breaking the circuit. We ended up having to:</p>
        <ul>
            <li>Text each other before making any changes to avoid conflicts</li>
            <li>Figure out how to combine our work without losing either person's progress</li>
            <li>Test everything after merging to make sure it still worked</li>
            <li>Decide who was working on which parts to avoid stepping on each other's toes</li>
        </ul>
        
        <p>It was definitely a learning experience about how important it is to communicate well when working on team projects, especially when you're both editing the same files.</p>
    </div>

    <div class="section">
        <div class="section-title">7. Conclusion</div>
        <div class="conclusion">
            <p>This lab helped us understand how to build and analyze a MIPS datapath. Here's what we learned:</p>
            <ul>
                <li>✓ How all the MIPS datapath parts work together</li>
                <li>✓ How instructions flow through the datapath step by step</li>
                <li>✓ How to build register file, ALU, and memory components</li>
                <li>✓ How control signals work and coordinate everything</li>
                <li>✓ How to analyze hex programs and different instruction types</li>
                <li>✓ How high-level programming connects to what the processor actually does</li>
            </ul>
            <p>Our datapath has all the main parts needed to run MIPS instructions, showing how processors get, decode, and run instructions. Looking at the hex program helped us see how different instruction types use different parts of the datapath.</p>
            <p>This lab taught us a lot about computer architecture basics and how complicated it is to design a good processor datapath.</p>
        </div>
    </div>

    <div class="section">
        <div class="section-title">8. References</div>
        <ul>
            <li>Logisim-evolution Documentation: https://github.com/logisim-evolution/logisim-evolution</li>
            <li>Computer Organization and Design, Patterson & Hennessy</li>
            <li>Digital Design and Computer Architecture, Harris & Harris</li>
            <li>CENG 351 Course Materials: Computer Architecture I</li>
            <li>MIPS Architecture Reference Manual</li>
        </ul>
    </div>
    </div>
</body>
</html>
