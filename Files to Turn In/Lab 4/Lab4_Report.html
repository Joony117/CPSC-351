<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 4: Datapath Implementation - Report</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: white;
            color: #333;
        }
        .container {
            max-width: 8.5in;
            margin: 0 auto;
            padding: 1in;
            background: white;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .course-info {
            font-size: 14px;
            color: #95a5a6;
        }
        
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        
        .subsection-title {
            font-size: 16px;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 10px;
            margin-top: 20px;
        }
        
        .screenshot-container {
            text-align: center;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        .screenshot {
            max-width: 100%;
            height: auto;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-height: 400px;
            width: auto;
        }
        
        .screenshot-caption {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 8px;
            font-style: italic;
        }
        
        .question {
            background-color: #ecf0f1;
            padding: 15px;
            border-left: 4px solid #e74c3c;
            margin: 15px 0;
        }
        
        .question-text {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .answer {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #27ae60;
            margin: 10px 0;
        }
        
        .circuit-description {
            background-color: #fff3cd;
            padding: 15px;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .instruction-analysis {
            background-color: #e8f4fd;
            padding: 15px;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .hex-instruction {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .register-table {
            margin: 20px 0;
            border-collapse: collapse;
            width: 100%;
        }
        
        .register-table th,
        .register-table td {
            border: 1px solid #bdc3c7;
            padding: 8px;
            text-align: center;
        }
        
        .register-table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }
        
        .register-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .conclusion {
            background-color: #e8f5e8;
            padding: 20px;
            border: 1px solid #27ae60;
            border-radius: 5px;
            margin-top: 30px;
        }
        
        .team-info {
            background-color: #f0f8ff;
            padding: 15px;
            border: 1px solid #3498db;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        
        .placeholder {
            background-color: #f8f9fa;
            border: 2px dashed #6c757d;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .placeholder-text {
            color: #6c757d;
            font-style: italic;
            font-size: 14px;
        }
        
        .datapath-component {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .component-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        @media print {
            body { margin: 20px; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
        <div class="title">CENG 351: Computer Architecture I</div>
        <div class="subtitle">Lab 4: Datapath Implementation</div>
        <div class="course-info">MIPS Datapath Design and Instruction Execution Analysis</div>
    </div>

    <div class="team-info">
        <div class="subsection-title">Team Information</div>
        <p><strong>Lab Partners:</strong> Gabriel Giancarlo, Jun Yi</p>
        <p><strong>Contributions:</strong></p>
        <ul>
            <li><strong>Gabriel Giancarlo:</strong> Report writing, instruction analysis, datapath explanation, and comprehensive documentation</li>
            <li><strong>Jun Yi:</strong> Circuit implementation, screenshot capture, simulation execution, and verification</li>
        </ul>
    </div>

    <div class="section">
        <div class="section-title">1. Introduction</div>
        <p>In this lab, we built and tested a MIPS datapath to see how a processor actually runs instructions. We put together all the main parts of a CPU datapath like instruction memory, register file, ALU, data memory, and control logic.</p>
        
        <div class="circuit-description">
            <div class="subsection-title">Datapath Overview</div>
            <p>Our MIPS datapath has these main parts:</p>
            <ul>
                <li><strong>Instruction Memory:</strong> Holds all the program instructions in hex format</li>
                <li><strong>Program Counter (PC):</strong> Keeps track of which instruction we're running</li>
                <li><strong>Register File:</strong> Has 32 registers that can each hold 32 bits</li>
                <li><strong>Arithmetic Logic Unit (ALU):</strong> Does all the math and logic operations</li>
                <li><strong>Data Memory:</strong> Stores data that the program needs to load and save</li>
                <li><strong>Control Logic:</strong> Figures out what each instruction does and tells other parts what to do</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <div class="section-title">2. Instruction Analysis</div>
        
        <div class="subsection-title">2.1 Hex Program Analysis</div>
        <p>We got a hex program that has these MIPS instructions:</p>
        
        <div class="instruction-analysis">
            <div class="subsection-title">Instruction Breakdown</div>
            <p><strong>Address 0x0000:</strong> <span class="hex-instruction">20100024</span> - addi $16, $0, 36 (Load immediate value 36 into register $16)</p>
            <p><strong>Address 0x0004:</strong> <span class="hex-instruction">ac100004</span> - sw $16, 4($0) (Store word from $16 to memory address 4)</p>
            <p><strong>Address 0x0008:</strong> <span class="hex-instruction">8c110004</span> - lw $17, 4($0) (Load word from memory address 4 into $17)</p>
            <p><strong>Address 0x000C:</strong> <span class="hex-instruction">2231ffff</span> - addi $17, $17, -1 (Decrement $17 by 1)</p>
            <p><strong>Address 0x0010:</strong> <span class="hex-instruction">02114022</span> - sub $8, $16, $17 (Subtract $17 from $16, store in $8)</p>
            <p><strong>Address 0x0014:</strong> <span class="hex-instruction">01114824</span> - and $9, $8, $17 (Bitwise AND of $8 and $17, store in $9)</p>
            <p><strong>Address 0x0018:</strong> <span class="hex-instruction">1109fff9</span> - beq $8, $9, -7 (Branch if $8 equals $9, jump back 7 instructions)</p>
            <p><strong>Address 0x001C:</strong> <span class="hex-instruction">00000000</span> - nop (No operation)</p>
        </div>

        <div class="subsection-title">2.2 Program Flow Analysis</div>
        <p>This program basically makes a simple loop that:</p>
        <ol>
            <li>Puts the number 36 into register $16</li>
            <li>Saves that number in memory location 4</li>
            <li>Loads the number back into register $17</li>
            <li>Takes 1 away from $17</li>
            <li>Finds the difference between $16 and $17</li>
            <li>Does a bitwise AND operation</li>
            <li>Jumps back if the values are the same, making it loop</li>
        </ol>
    </div>

    <div class="section">
        <div class="section-title">3. Datapath Implementation</div>
        
        <div class="subsection-title">3.1 Circuit Components</div>
        
        <div class="datapath-component">
            <div class="component-name">Program Counter (PC)</div>
            <p>This is a 32-bit register that remembers which instruction we're working on. It goes up by 4 for each instruction (unless we're jumping or branching).</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Instruction Memory</div>
            <p>This is where all the program instructions are stored. The PC tells it which instruction we want, and it gives us back the 32-bit instruction.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Register File</div>
            <p>This has 32 registers that can each hold 32 bits. We can read from two registers at once and write to one. Register $0 is always zero.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Arithmetic Logic Unit (ALU)</div>
            <p>This does all the math and logic stuff. It takes two 32-bit numbers and can add, subtract, do AND/OR operations, and compare them.</p>
        </div>
        
        <div class="datapath-component">
            <div class="component-name">Data Memory</div>
            <p>This is where we store data that the program needs. We can read from it and write to it using load and store instructions.</p>
        </div>

        <div class="subsection-title">3.2 Control Signals</div>
        <p>The datapath uses different control signals to make sure everything works together:</p>
        <ul>
            <li><strong>RegWrite:</strong> Lets us write to the register file</li>
            <li><strong>MemRead/MemWrite:</strong> Controls when we can read or write to data memory</li>
            <li><strong>ALUOp:</strong> Tells the ALU what operation to do</li>
            <li><strong>RegDst:</strong> Picks which register to write to</li>
            <li><strong>ALUSrc:</strong> Chooses between register values and immediate values</li>
            <li><strong>Branch:</strong> Lets branch instructions work</li>
        </ul>
    </div>

    <div class="section">
        <div class="section-title">4. Screenshots and Simulation Results</div>
        
        <div class="subsection-title">4.1 Initial Circuit State</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/startState.png" alt="Initial datapath circuit state" class="screenshot">
            <div class="screenshot-caption">Figure 1: Initial datapath circuit state</div>
        </div>

        <div class="subsection-title">4.2 Instruction #1: ADDI Instruction Execution</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins_1_addi.png" alt="ADDI instruction execution showing immediate value loading" class="screenshot">
            <div class="screenshot-caption">Figure 2: ADDI instruction execution (addi $16, $0, 36)</div>
        </div>

        <div class="subsection-title">4.3 Instruction #2: Save Word Control Signals</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins_2_SW.png" alt="Save word instruction control signals" class="screenshot">
            <div class="screenshot-caption">Figure 3: Save word control signals (sw $s0, 4($0))</div>
        </div>

        <div class="subsection-title">4.4 Instruction #3: Load Word Control Signals</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins_3_LW.png" alt="Load word instruction control signals" class="screenshot">
            <div class="screenshot-caption">Figure 4: Load word control signals (lw $17, 4($0))</div>
        </div>

        <div class="subsection-title">4.4 Instruction #4: ADDI Instruction Execution</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins4_addi.png" alt="ADDI instruction execution showing immediate value loading" class="screenshot">
            <div class="screenshot-caption">Figure 5: ADDI Instruction Execution (addi $17, $17, -1)</div>
        </div>

        <div class="subsection-title">4.5 Instruction #5: SUB Instruction Execution</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins5_sub.png" alt="SUB instruction execution showing subtraction operation" class="screenshot">
            <div class="screenshot-caption">Figure 6: SUB instruction execution (sub $8, $16, $17)</div>
        </div>

        <div class="subsection-title">4.6 Instruction #6: AND Instruction Execution</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins6_and.png" alt="AND instruction execution showing bitwise AND operation" class="screenshot">
            <div class="screenshot-caption">Figure 7: AND instruction execution (and $9, $8, $17)</div>
        </div>

        <div class="subsection-title">4.7 Instruction #7: BEQ Instruction Execution</div>
        <div class="screenshot-container">
            <img src="Screenshots lab 4/ins7_beq.png" alt="BEQ instruction execution showing branch equal operation" class="screenshot">
            <div class="screenshot-caption">Figure 8: BEQ instruction execution (beq $8, $9, -7)</div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">5. Lab Questions and Analysis</div>
      
        <div class="question">
          <div class="question-text">Question 1: Why did we use ROM for instruction memory and RAM for data memory?</div>
        </div>
        <div class="answer">
          <p><strong>Short answer:</strong> Instruction memory is a <em>ROM</em> in this lab because the program contents are fixed during simulation — we only read instructions. Data memory is a <em>RAM</em> because the program must <strong>load</strong> from and <strong>store</strong> to it during execution. </p>
        </div>
      
        <div class="question">
          <div class="question-text">Question 2: For instructions that write to memory or the register file, when does the processor actually write those values to memory? Why?.</div>
        </div>
        <div class="answer">
          <p><strong>Short answer:</strong> In the single-cycle datapath, writes happen at the <strong>clock edge</strong> of the cycle in which the instruction executes: <code>MemWrite</code> causes the data memory to commit on the clock tick for <code>sw</code>, and <code>RegWrite</code> commits to the register file on the same tick for instructions that write a register (e.g., <code>addi</code>, <code>lw</code>, R-type). This ensures all combinational paths settle before state updates. </p>
        </div>
      </div>
    <div class="section">
        <div class="section-title">6. Troubleshooting and Challenges</div>
        
        <div class="subsection-title">6.1 Collaboration and Merge Conflicts</div>
        <p>One of the biggest challenges we faced during this lab was working together on the same circuit file. Since we were both working on different parts of the skeleton, whenever one of us moved components around or changed something, we'd get merge conflicts when trying to combine our work.</p>
        
        <p>This was really frustrating because we had to put in extra effort to figure out how to merge our changes without breaking the circuit. We ended up having to:</p>
        <ul>
            <li>Text each other before making any changes to avoid conflicts</li>
            <li>Figure out how to combine our work without losing either person's progress</li>
            <li>Test everything after merging to make sure it still worked</li>
            <li>Decide who was working on which parts to avoid stepping on each other's toes</li>
        </ul>
        
        <p>It was definitely a learning experience about how important it is to communicate well when working on team projects, especially when you're both editing the same files.</p>
    </div>

    <div class="section">
        <div class="section-title">7. Conclusion</div>
        <div class="conclusion">
            <p>This lab helped us understand how to build and analyze a MIPS datapath. Here's what we learned:</p>
            <ul>
                <li>✓ How all the MIPS datapath parts work together</li>
                <li>✓ How instructions flow through the datapath step by step</li>
                <li>✓ How to build register file, ALU, and memory components</li>
                <li>✓ How control signals work and coordinate everything</li>
                <li>✓ How to analyze hex programs and different instruction types</li>
                <li>✓ How high-level programming connects to what the processor actually does</li>
            </ul>
            <p>Our datapath has all the main parts needed to run MIPS instructions, showing how processors get, decode, and run instructions. Looking at the hex program helped us see how different instruction types use different parts of the datapath.</p>
            <p>This lab taught us a lot about computer architecture basics and how complicated it is to design a good processor datapath.</p>
        </div>
    </div>

    <div class="section">
        <div class="section-title">8. References</div>
        <ul>
            <li>Logisim-evolution Documentation: https://github.com/logisim-evolution/logisim-evolution</li>
            <li>Computer Organization and Design, Patterson & Hennessy</li>
            <li>Digital Design and Computer Architecture, Harris & Harris</li>
            <li>CENG 351 Course Materials: Computer Architecture I</li>
            <li>MIPS Architecture Reference Manual</li>
        </ul>
    </div>
    </div>
</body>
</html>
